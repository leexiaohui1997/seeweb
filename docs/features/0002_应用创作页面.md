# 应用创作页面

## 需求描述

新增应用创作页面，支持用户打开应用并进行创作。打开应用时跳转至该页面。

## 需求详情

### 1. 新增应用创作页面

#### 1.1 页面路径

- **文件路径**: `pages/workspace/app/[name].vue`
- **路由路径**: `/workspace/app/:name`
- **Layout**: 使用 `workspace` layout（通过 `definePageMeta` 配置）

#### 1.2 页面结构

- **最外层容器**:
  - 使用 `flex: 1`，占满 `content` 的高度
  - 使用 `flex column` 布局

- **头部区域**:
  - 高度：`40px`
  - 背景色：主题色 0.05 透明度（`rgba($primary-color, 0.05)`）
  - 内边距：`16px` 左右
  - 布局：`flex` 垂直居中，左右分布（`justify-content: space-between`, `align-items: center`）

- **头部左侧**:
  - 返回按钮：使用 Element Plus 的 `el-button`，`size="small"`，点击返回上一级路由（使用 `navigateTo(-1)` 或 `router.back()`）
  - 应用标题：显示应用的 `title` 字段

- **内容区**:
  - `flex: 1` 占满剩余高度
  - 暂不实现具体内容（预留空间）

### 2. 后端 API 接口

#### 2.1 根据 name 获取应用信息接口

- **路径**: `GET /api/user/apps/name/[name]`
- **文件路径**: `server/api/user/apps/name/[name].get.ts`
- **鉴权**: 需要登录（通过 `/api/user/*` 路由自动鉴权）
- **功能**:
  - 根据 `name` 参数查询应用
  - 只能查询当前用户的应用（验证 `userId`）
  - 只查询未删除的应用（`deletedAt IS NULL`）
  - 如果应用不存在或无权限，返回 404
- **响应格式**:
  ```typescript
  {
    success: boolean
    message: string
    data: {
      id: number
      name: string
      title: string
      userId: number
      createdAt: number // Unix 时间戳（秒）
      updatedAt: number // Unix 时间戳（秒）
    }
  }
  ```

#### 2.2 参数验证

- 使用 Zod schema 验证 `name` 参数
- 参考现有的验证方式：`server/utils/validation/apps.ts`

### 3. 前端实现

#### 3.1 页面组件实现

- **文件路径**: `pages/workspace/app/[name].vue`
- **功能**:
  - 从路由参数获取 `name`
  - 调用 API 获取应用信息
  - 显示加载状态
  - 处理错误情况（应用不存在、无权限等）
  - 实现返回按钮功能
  - 显示应用标题

#### 3.2 修改应用卡片组件

- **文件路径**: `components/AppAppCard.vue`
- **修改内容**:
  - 修改 `handleOpen` 方法，将跳转路径从 `/` 改为 `/workspace/app/${app.name}`

### 4. 技术实现细节

#### 4.1 路由参数获取

在 Nuxt 3 中，使用 `useRoute()` 获取路由参数：

```typescript
const route = useRoute()
const appName = route.params.name as string
```

#### 4.2 API 调用

使用 `$fetch` 调用 API：

```typescript
const response = await $fetch<{
  success: boolean
  message: string
  data: App
}>(`/api/user/apps/name/${appName}`, {
  method: 'GET',
})
```

#### 4.3 返回上一级路由

使用 Nuxt 的 `navigateTo` 或 Vue Router 的 `router.back()`：

```typescript
// 方式1：使用 navigateTo
navigateTo(-1)

// 方式2：使用 router.back()
const router = useRouter()
router.back()
```

#### 4.4 主题色使用

主题色定义在 `assets/scss/_variables.scss` 中：

- 变量名：`$primary-color`
- 值：`#c535ec`
- 在 SCSS 中使用：`rgba($primary-color, 0.05)`

#### 4.5 布局高度处理

由于 `workspace` layout 的 `.content` 已经设置了 `flex: 1` 和 `height: 0`，应用创作页面的最外层容器也需要设置 `flex: 1` 和 `height: 0` 来正确占满高度。

### 5. 实现顺序建议

1. **后端 API**:
   - 创建 `server/api/user/apps/name/[name].get.ts` 文件
   - 实现根据 name 查询应用的逻辑
   - 添加参数验证

2. **前端页面**:
   - 创建 `pages/workspace/app/[name].vue` 文件
   - 实现页面结构和样式
   - 实现 API 调用和数据加载
   - 实现返回按钮功能

3. **修改应用卡片**:
   - 修改 `components/AppAppCard.vue` 中的 `handleOpen` 方法

### 6. 样式参考

参考现有页面的样式实现：

- `pages/workspace/apps.vue` - 页面布局和样式
- `components/AppAppCard.vue` - 按钮样式
- `components/AppWorkspaceMenu.vue` - 主题色背景使用（`rgba($primary-color, 0.05)`）

### 7. 错误处理

- 应用不存在：显示错误提示，可以返回上一页
- 无权限访问：显示错误提示，可以返回上一页
- 网络错误：显示错误提示，可以重试

### 8. 测试要点

1. **路由跳转**:
   - 从应用列表点击"打开"按钮，正确跳转到应用创作页面
   - URL 参数正确传递

2. **API 调用**:
   - 正常获取应用信息
   - 应用不存在时返回 404
   - 无权限访问时返回 404

3. **页面功能**:
   - 返回按钮正确返回上一页
   - 应用标题正确显示
   - 页面布局正确（占满高度）

4. **样式**:
   - 头部样式符合要求（高度、背景色、内边距）
   - 内容区占满剩余高度
   - 响应式布局正常
